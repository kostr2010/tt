main-refactored - version with several enhancements in structure and logic.
